services:
  # The daemon service that controls the LED matrix and talks to Twitch
  daemon:
    build: .
    container_name: matrix_daemon
    privileged: true
    volumes:
      - /tmp:/tmp
      # Persist the token file on the host machine
      - ./twitch_tokens:/etc/twitch_matrix
      # Mount a volume for persistent logs
      - ./logs:/app/logs
    # Inject credentials as environment variables at runtime
    environment:
      - TWITCH_CLIENT_ID=YOUR_CLIENT_ID_HERE
      - TWITCH_CLIENT_SECRET=YOUR_CLIENT_SECRET_HERE
      - TWITCH_USERNAME=YOUR_TWITCH_USERNAME

  # The control panel service that runs the CherryPy web server
  control-panel:
    build: .
    container_name: matrix_control_panel
    command: ["python", "control_panel.py"]
    depends_on:
      - daemon
    ports:
      - "8080:8080"
    volumes:
      - /tmp:/tmp
      # Mount a volume for persistent logs
      - ./logs:/app/logs
