<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Twitch LED Matrix Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #f0f0f0;
        }
        .container {
            max-width: 800px;
        }
        .card {
            background-color:#1a1a1a;
            border: 1px solid #444;
            margin-bottom: 2rem;
            color:#f0f0f0
        }
        .btn {
            margin: 5px;
        }
        #status-alert {
            display: none;
            margin-top: 20px;
        }
        .form-label {
            margin-bottom: 0;
        }
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        input[type=color] {
            min-width: 50px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="card p-4 rounded-3 shadow">
            <h1 class="text-center mb-4">Twitch LED Matrix Control</h1>
            <div class="card p-4 rounded-3 shadow">
                <div class="text-center">
                    <h5 class="mb-3">Twitch Integration</h5>
                    <div class="card-body rounded-3">
                        <button class="btn btn-success" onclick="sendCommand('start')">Start</button>
                        <button class="btn btn-danger" onclick="sendCommand('stop')">Stop</button>
                    </div>
                </div>
                <hr class="my-4">
                <div class="text-center">
                    <h5 class="mb-3">Manual Animations</h5>
                    <button class="btn btn-primary" onclick="sendCommand('fireworks')">Fireworks</button>
                    <button class="btn btn-info" onclick="sendCommand('heart')">Heart</button>
                    <button class="btn btn-warning" onclick="sendCommand('smiley')">Smiley</button>
                </div>
            </div>

        <div class="card p-4 rounded-3 shadow">
            <h2 class="text-center mb-4">Live Configuration</h2>
            <form id="config-form">
                <div class="config-grid">
                    <!-- General Settings -->
                    <div>
                        <h5>General</h5>
                        <div class="mb-2">
                            <label for="BRIGHTNESS" class="form-label">Brightness</label>
                            <input type="range" class="form-range" min="0" max="100" value="100" id="BRIGHTNESS">
                        </div>
                    </div>
                    <!-- Animation Durations -->
                    <div>
                        <h5>Animation Durations (s)</h5>
                        <div class="mb-2">
                            <label for="FIREWORK_DURATION" class="form-label">Fireworks</label>
                            <input type="range" class="form-range" min="1" max="30" value="5" id="FIREWORK_DURATION">
                            <output for="FIREWORK_DURATION" id="firework-duration-output">5</output>
                        </div>
                        <div class="mb-2">
                            <label for="HEART_DURATION" class="form-label">Heart</label>
                            <input type="range" class="form-range" min="1" max="30" value="10" id="HEART_DURATION">
                            <output for="HEART_DURATION" id="heart-duration-output">10</output>
                        </div>
                        <div class="mb-2">
                            <label for="SMILEY_DURATION" class="form-label">Smiley</label>
                            <input type="range" class="form-range" min="1" max="30" value="10" id="SMILEY_DURATION">
                            <output for="SMILEY_DURATION" id="smiley-duration-output">10</output>
                        </div>
                    </div>
                    <!-- Firework Physics -->
                    <div>
                        <h5>Firework Physics</h5>
                        <div class="mb-2">
                            <label for="MAX_ROCKETS" class="form-label">Max Rockets</label>
                            <input type="range" class="form-range" min="1" max="20" value="10" id="MAX_ROCKETS">
                            <output for="MAX_ROCKETS" id="max-rockets-output">10</output>
                        </div>
                         <div class="mb-2">
                            <label for="ROCKET_SIZE" class="form-label">Rocket Size</label>
                            <input type="range" class="form-range" min="1" max="5" value="2" id="ROCKET_SIZE">
                            <output for="ROCKET_SIZE" id="rocket-size-output">2</output>
                        </div>
                        <div class="mb-2">
                            <label for="PARTICLE_SIZE" class="form-label">Particle Size</label>
                            <input type="range" class="form-range" min="1" max="5" value="2" id="PARTICLE_SIZE">
                            <output for="PARTICLE_SIZE" id="particle-size-output">2</output>
                        </div>
                    </div>
                    <!-- Colors -->
                    <div>
                        <h5>Colors</h5>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="HEART_COLOR" class="form-label">Heart Color</label>
                            <input type="color" class="form-control form-control-color" id="HEART_COLOR" value="#FF1493">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="SUBS_COLOR" class="form-label">"SUBS" Text</label>
                            <input type="color" class="form-control form-control-color" id="SUBS_COLOR" value="#FFFF00">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="NUM_COLOR" class="form-label">Number Text</label>
                            <input type="color" class="form-control form-control-color" id="NUM_COLOR" value="#FFFFFF">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="SCROLL_COLOR" class="form-label">Scroll Text</label>
                            <input type="color" class="form-control form-control-color" id="SCROLL_COLOR" value="#00FF00">
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label for="SCROLL_NUM_COLOR" class="form-label">Scroll Number</label>
                            <input type="color" class="form-control form-control-color" id="SCROLL_NUM_COLOR" value="#FF69B4">
                        </div>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <button type="button" class="btn btn-lg btn-success" onclick="updateConfig()">Save & Apply</button>
                </div>
            </form>
        </div>

        <div id="status-alert" class="alert" role="alert"></div>
    </div>

    <script>
        function sendCommand(command) {
            const statusAlert = document.getElementById('status-alert');
            fetch(`/${command}`)
                .then(handleResponse)
                .then(data => showStatus(data, 'success'))
                .catch(error => showStatus(`Error: ${error.message}`, 'danger'));
        }

        function updateConfig() {
            const configData = {};
            document.querySelectorAll('#config-form input').forEach(input => {
                configData[input.id] = input.value;
            });

            fetch('/update_config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(configData),
            })
            .then(handleResponse)
            .then(data => showStatus(data, 'success'))
            .catch(error => showStatus(`Error: ${error.message}`, 'danger'));
        }

        function handleResponse(response) {
            if (!response.ok) {
                return response.text().then(text => { throw new Error(text || 'Unknown error occurred') });
            }
            return response.text();
        }

        function showStatus(message, type) {
            const statusAlert = document.getElementById('status-alert');
            statusAlert.className = `alert alert-${type}`;
            statusAlert.textContent = message;
            statusAlert.style.display = 'block';
        }

        const fireworkDurationRangeInput = document.getElementById('FIREWORK_DURATION');
        const fireworkMaxRocketsInput = document.getElementById('MAX_ROCKETS');
        const fireworkRocketSizeInput = document.getElementById('ROCKET_SIZE');
        const fireworkParticleSizeInput = document.getElementById('PARTICLE_SIZE');
        const heartDurationRangeInput = document.getElementById('HEART_DURATION');
        const smileyDurationRangeInput = document.getElementById('SMILEY_DURATION');

        fireworkDurationRangeInput.addEventListener('input', function() {
            document.getElementById('firework-duration-output').textContent = this.value;
        });
        fireworkMaxRocketsInput.addEventListener('input', function() {
            document.getElementById('max-rockets-output').textContent = this.value;
        });
        fireworkRocketSizeInput.addEventListener('input', function() {
            document.getElementById('rocket-size-output').textContent = this.value;
        });
        fireworkParticleSizeInput.addEventListener('input', function() {
            document.getElementById('particle-size-output').textContent = this.value;
        });
        heartDurationRangeInput.addEventListener('input', function() {
            document.getElementById('heart-duration-output').textContent = this.value;
        });
        smileyDurationRangeInput.addEventListener('input', function() {
            document.getElementById('smiley-duration-output').textContent = this.value;
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
